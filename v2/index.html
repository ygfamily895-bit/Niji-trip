<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Niji Trip 2026 (v2)</title>
  <style>
    :root{
      --bg-main:#ffe4b8;
      --bg-card:#fff7e8;
      --brown:#7a4a26;
      --radius:20px;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;
      background:var(--bg-main);
    }
    header{
      padding:16px;
      background:#fff3da;
      border-radius:0 0 var(--radius) var(--radius);
    }
    h1{margin:0 0 6px;color:var(--brown)}
    .sub{opacity:.85;color:#5c3a1c}
    .btn-row{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;align-items:center;
    }
    button{
      border:none;
      padding:8px 14px;
      border-radius:999px;
      background:#ffd89a;
      color:#5c3a1c;
      font-weight:700;
    }
    .badge{
      display:inline-block;
      padding:8px 12px;
      border-radius:999px;
      background:#fff3c5;
      color:#5c3a1c;
      font-weight:700;
    }
    main{padding:16px}
    .day{
      background:#eaf6ff;
      border-radius:var(--radius);
      padding:14px;
      margin-bottom:14px;
    }
    .card{
      background:var(--bg-card);
      border-radius:16px;
      padding:12px;
      margin-top:10px;
      white-space:pre-wrap;
      word-break:break-word;
      min-height:44px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .del{
      background:#ffd1c7;
    }
    [contenteditable]{outline:none}
    .hint{margin-top:10px;font-size:13px;color:#6b4a2c;opacity:.9}
  </style>
</head>

<body>
  <header>
    <h1>Niji Trip 2026 ğŸŒˆ <small style="font-size:14px;opacity:.75">(v2)</small></h1>
    <div class="sub" contenteditable="true" id="subtitle">æ±äº¬è¡Œç¨‹ï¼Œå¯è‡ªç”±ç·¨è¼¯ã€‚</div>

    <div class="btn-row">
      <button id="addDayBtn" type="button">ï¼‹ æ–°å¢ä¸€å¤©</button>
      <button id="clearBtn" type="button">æ¸…é™¤å„²å­˜</button>
      <span class="badge" id="saveStatus">å·²è¼‰å…¥ âœ…</span>
    </div>

    <div class="hint">ç›®å‰ç‰ˆæœ¬ï¼šåªä½¿ç”¨æœ¬æ©Ÿ localStorageï¼ˆä¸å« Firebaseï¼‰ã€‚</div>
  </header>

  <main id="days"></main>

  <script>
    // ====== localStorage keysï¼ˆv2 å°ˆç”¨ï¼Œé¿å…è·ŸèˆŠç‰ˆæ‰“æ¶ï¼‰======
    const KEY_DAYS = "niji_v2_days";
    const KEY_SUB  = "niji_v2_subtitle";

    const daysEl = document.getElementById("days");
    const addDayBtn = document.getElementById("addDayBtn");
    const clearBtn = document.getElementById("clearBtn");
    const saveStatus = document.getElementById("saveStatus");
    const subtitleEl = document.getElementById("subtitle");

    let days = safeParse(localStorage.getItem(KEY_DAYS), []);
    subtitleEl.textContent = localStorage.getItem(KEY_SUB) || subtitleEl.textContent;

    function safeParse(raw, fallback){
      try { return raw ? JSON.parse(raw) : fallback; }
      catch { return fallback; }
    }

    function setStatus(text){
      saveStatus.textContent = text;
      window.clearTimeout(setStatus._t);
      setStatus._t = window.setTimeout(()=> saveStatus.textContent = "å·²å„²å­˜ âœ…", 800);
    }

    function save(){
      localStorage.setItem(KEY_DAYS, JSON.stringify(days));
      setStatus("å„²å­˜ä¸­â€¦");
    }

    function render(){
      daysEl.innerHTML = "";
      days.forEach((d, i) => {
        const wrap = document.createElement("div");
        wrap.className = "day";

        wrap.innerHTML = `
          <div class="row">
            <strong>Day ${i + 1}</strong>
            <button class="del" type="button" data-del="${i}">åˆªé™¤</button>
          </div>
          <div class="card" contenteditable="true" data-idx="${i}"></div>
        `;

        const card = wrap.querySelector(".card");
        card.textContent = d.text || "";

        card.addEventListener("input", () => {
          days[i].text = card.innerText;
          save();
        });

        wrap.querySelector("[data-del]").addEventListener("click", () => {
          if (confirm(`ç¢ºå®šåˆªé™¤ Day ${i+1}ï¼Ÿ`)) {
            days.splice(i, 1);
            save();
            render();
          }
        });

        daysEl.appendChild(wrap);
      });

      if (days.length === 0) {
        const empty = document.createElement("div");
        empty.className = "day";
        empty.innerHTML = `<strong>é‚„æ²’æœ‰è¡Œç¨‹</strong><div class="card">æŒ‰ã€Œï¼‹ æ–°å¢ä¸€å¤©ã€é–‹å§‹ã€‚</div>`;
        daysEl.appendChild(empty);
      }
    }

    addDayBtn.addEventListener("click", () => {
      days.push({ text: "æ–°å¢è¡Œç¨‹å…§å®¹â€¦" });
      save();
      render();
    });

    clearBtn.addEventListener("click", () => {
      if (confirm("ç¢ºå®šæ¸…é™¤ v2 çš„æ‰€æœ‰è³‡æ–™ï¼Ÿï¼ˆä¸å½±éŸ¿èˆŠç‰ˆï¼‰")) {
        localStorage.removeItem(KEY_DAYS);
        localStorage.removeItem(KEY_SUB);
        days = [];
        subtitleEl.textContent = "æ±äº¬è¡Œç¨‹ï¼Œå¯è‡ªç”±ç·¨è¼¯ã€‚";
        setStatus("å·²æ¸…é™¤ âœ…");
        render();
      }
    });

    subtitleEl.addEventListener("input", () => {
      localStorage.setItem(KEY_SUB, subtitleEl.innerText);
      setStatus("å„²å­˜ä¸­â€¦");
    });

    render();
    setStatus("å·²è¼‰å…¥ âœ…");
  </script>
</body>
</html>
